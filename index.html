<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Rhythm Game + Chart Editor</title>
  <style>
    :root {
      --accent: #4fd1c5;
      --bg: #111;
      --panel: #1a1a1a;
      --text: #fff;
      --muted: #aaa;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      overflow: hidden;
    }
    canvas {
      display: block;
      margin: auto;
      background: #000;
    }
    #topbar {
      position: absolute;
      top: 12px; left: 12px; right: 12px;
      display: flex; gap: 10px; align-items: center;
      z-index: 10;
    }
    .btn {
      background: var(--accent);
      color: #000;
      border: none;
      padding: 10px 14px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: transform .05s ease;
    }
    .btn:active { transform: translateY(1px); }
    .btn.secondary {
      background: #2a2a2a;
      color: var(--text);
      border: 1px solid #333;
    }
    #rightpanel {
      position: absolute;
      top: 60px; right: 12px;
      width: 340px; height: calc(100vh - 72px);
      background: linear-gradient(180deg, #141414, #0e0e0e);
      border: 1px solid #232323;
      border-radius: 12px;
      padding: 12px;
      display: grid;
      grid-template-rows: auto auto 1fr auto;
      gap: 10px;
      z-index: 9;
    }
    #rightpanel h3 {
      margin: 6px 0 2px;
      font-size: 16px; color: var(--muted);
      font-weight: 600; letter-spacing: .3px;
    }
    #chart-input {
      width: 100%; height: 140px; resize: none;
      background: #0b0b0b; color: #ddd;
      border: 1px solid #1f1f1f; border-radius: 8px;
      padding: 8px; font-size: 12px; line-height: 1.3;
    }
    #chart-output {
      width: 100%; height: 100%; resize: none;
      background: #0b0b0b; color: #8be9fd;
      border: 1px solid #1f1f1f; border-radius: 8px;
      padding: 8px; font-size: 12px; line-height: 1.3;
      white-space: pre;
    }
    #statusbar {
      position: absolute;
      left: 12px; bottom: 12px;
      display: flex; gap: 16px;
      background: rgba(0,0,0,.4);
      padding: 8px 12px;
      border-radius: 10px;
      border: 1px solid #222;
      backdrop-filter: blur(4px);
      z-index: 10;
      font-size: 14px;
    }
    .pill { color: #ddd; }
    .pill b { color: var(--accent); }
    #results {
      position: absolute; inset: 0;
      display: none; place-items: center;
      background: rgba(0,0,0,.6);
      z-index: 20;
    }
    #results .card {
      background: #0f0f0f; border: 1px solid #222; border-radius: 14px;
      padding: 20px 24px; width: 380px; text-align: center;
      box-shadow: 0 10px 40px rgba(0,0,0,.6);
    }
    #results h2 { margin: 0 0 8px; }
    #results .rank { font-size: 56px; margin: 8px 0; color: var(--accent); text-shadow: 0 0 16px rgba(79,209,197,.4); }
    #results .row { display: flex; justify-content: space-between; margin: 6px 0; color: #ccc; }
    #results .row b { color: #fff; }
  </style>
</head>
<body>
  <div id="topbar">
    <button class="btn" id="playBtn">Play default chart</button>
    <button class="btn secondary" id="editorBtn">Chart editor (record)</button>
    <button class="btn secondary" id="saveBtn">Save chart to panel</button>
    <button class="btn secondary" id="loadBtn">Load chart from paste</button>
  </div>

  <div id="rightpanel">
    <div>
      <h3>Paste chart JSON</h3>
      <textarea id="chart-input" placeholder='{"offset":0,"lanes":4,"notes":[{"t":1,"lane":0}]}'></textarea>
    </div>
    <div>
      <h3>Saved/exported chart</h3>
    </div>
    <textarea id="chart-output" readonly></textarea>
    <div style="display:flex; gap:8px;">
      <button class="btn secondary" id="clearOut">Clear</button>
      <button class="btn secondary" id="copyOut">Copy</button>
    </div>
  </div>

  <div id="statusbar">
    <div class="pill">FPS: <b id="fps">0</b></div>
    <div class="pill">Score: <b id="score">0</b></div>
    <div class="pill">Combo: <b id="combo">0</b></div>
    <div class="pill">Accuracy: <b id="acc">0%</b></div>
    <div class="pill">Rank: <b id="rank">-</b></div>
    <div class="pill">Mode: <b id="mode">Idle</b></div>
  </div>

  <div id="results">
    <div class="card">
      <h2>Results</h2>
      <div class="rank" id="res-rank">S</div>
      <div class="row"><span>Accuracy</span><b id="res-acc">0%</b></div>
      <div class="row"><span>Max combo</span><b id="res-maxcombo">0</b></div>
      <div class="row"><span>Score</span><b id="res-score">0</b></div>
      <div style="margin-top:14px; display:flex; gap:8px; justify-content:center;">
        <button class="btn" id="resultsClose">Close</button>
        <button class="btn secondary" id="resultsReplay">Replay</button>
      </div>
    </div>
  </div>

  <canvas id="game" width="960" height="640"></canvas>
  <audio id="song" src="song.mp3" preload="auto"></audio>

  <script src="game.js"></script>
</body>
</html>
